# Centrifugue Session Context

## Project Overview

Centrifugue (note spelling: Centrifuge + fugue wordplay) is a Firefox/Zen Browser extension that extracts audio stems from YouTube videos using Demucs AI.

**Stack:**
- Browser extension: JavaScript (WebExtensions API)
- Native host: Python 3.9+ with Demucs, yt-dlp, FFmpeg
- Platform: macOS with Apple Silicon GPU acceleration (MPS)

## Recent Work Completed

### 1. Speckit Workflow Setup
Copied and adapted specification-driven development workflow from memoryloop project:

- **Commands** (`.claude/commands/speckit.*.md`):
  - `specify` - Create feature specifications
  - `clarify` - Resolve ambiguities
  - `plan` - Create implementation plans
  - `tasks` - Generate task breakdowns
  - `implement` - Execute tasks
  - `checklist` - Quality requirements
  - `analyze` - Cross-artifact consistency

- **Templates** (`.specify/templates/`): spec, plan, tasks, checklist, ledger
- **Scripts** (`.specify/scripts/bash/`): common.sh, check-prerequisites.sh, create-new-feature.sh, setup-plan.sh
- **Constitution** (`.specify/memory/constitution.md`): Project principles

### 2. Spelling Standardization
Fixed all instances of "centrifuge" â†’ "centrifugue" across the codebase:

| Item | Old | New |
|------|-----|-----|
| Python host | `centrifuge_host.py` | `centrifugue_host.py` |
| Native messaging | `com.centrifuge.stemextractor` | `com.centrifugue.stemextractor` |
| Extension ID | `centrifuge@nicholassmith.dev` | `centrifugue@nicholassmith.dev` |
| Progress files | `~/.centrifuge_*.json` | `~/.centrifugue_*.json` |
| CSS classes | `centrifuge-*` | `centrifugue-*` |
| All user-visible text | Centrifuge | Centrifugue |

### 3. Native Messaging Fix
Fixed broken native messaging configuration:
- Created proper manifest at `native-host/com.centrifugue.stemextractor.json`
- Updated symlinks in `~/Library/Application Support/Mozilla/NativeMessagingHosts/`
- Manifest is gitignored (generated by install.sh with machine-specific paths)

### 4. Project Branding
- Added circular equalizer logo (`logo.svg`) with 4 color gradient sections
- Updated README with centered logo header

## Current State

**Working:**
- Extension loads in Firefox/Zen Browser
- Native messaging configured correctly
- Speckit workflow ready for feature development
- 40+ atomic commits following rules.md conventions

**To test after session:**
1. Reload extension in `about:debugging#/runtime/this-firefox`
2. Navigate to YouTube video
3. Click floating button to test download/stems functionality

## Key Files

| File | Purpose |
|------|---------|
| `native-host/centrifugue_host.py` | Python backend, stem separation |
| `extension/background.js` | Native messaging bridge |
| `extension/content.js` | YouTube floating UI |
| `install.sh` | Setup script (run if native messaging fails) |
| `.claude/rules.md` | Git commit conventions |
| `CLAUDE.md` | Full project documentation |

## Git Status

Branch: `main` (ahead of origin by 15 commits - not pushed)

## Notes for Future Sessions

- Always spell it "Centrifugue" (with the "u")
- Native messaging manifest is gitignored - run `./install.sh` if it's missing
- Follow atomic commit rules in `.claude/rules.md`
- Check `specs/` directory for any feature branches with specifications
